<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="App per lo studio con domande a scelta multipla">
    <title>Multiple Choice Study App</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="logo">üìö Study Hub</h1>
            <div class="progress-container" id="progressContainer" style="display: none;">
                <div class="progress-text" id="progressText">Domanda 1 di 10</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </header>

        <!-- Home View: Course Selection -->
        <div id="homeView" class="view active">
            <div class="view-header">
                <h2>Scegli un Corso</h2>
                <p>Seleziona il corso per iniziare a studiare</p>
                <div class="button-group">
                    <button class="btn btn-import" id="importButton">üì• Importa Quiz</button>
                    <button class="btn btn-secondary" id="generateCodeButton" title="Genera codice per data.js">üîß
                        Genera Codice per GitHub</button>
                </div>
            </div>
            <div id="courseList" class="card-grid"></div>
        </div>

        <!-- Deck Selection View -->
        <div id="deckView" class="view">
            <div class="view-header">
                <button class="back-button" id="backToCourses">‚Üê Torna ai Corsi</button>
                <h2 id="courseTitle">Digital Communications</h2>
                <p>Scegli un deck di domande</p>
                <button class="btn btn-primary" id="addQuestionsButton" style="margin-top: 1rem;">‚ûï Aggiungi
                    Domande</button>
            </div>
            <div id="deckList" class="card-grid"></div>
        </div>

        <!-- Quiz View -->
        <div id="quizView" class="view">
            <div class="quiz-container">
                <div class="quiz-header">
                    <button class="back-button" id="backToDecks">‚Üê Torna ai Deck</button>
                    <div class="quiz-info">
                        <span id="quizDeckName">Appendix Questions</span>
                        <span class="score" id="scoreDisplay">Punteggio: 0/0</span>
                    </div>
                </div>

                <div class="question-card" id="questionCard">
                    <div class="question-text" id="questionText"></div>
                    <div class="answers-container" id="answersContainer"></div>

                    <div class="feedback" id="feedback" style="display: none;">
                        <div class="feedback-icon" id="feedbackIcon"></div>
                        <div class="feedback-text" id="feedbackText"></div>
                    </div>

                    <div class="quiz-actions">
                        <button class="btn btn-secondary" id="prevButton">‚Üê Precedente</button>
                        <button class="btn btn-primary" id="confirmButton">Conferma</button>
                        <button class="btn btn-secondary" id="nextQuestionButton">Prossima ‚Üí</button>
                        <button class="btn btn-primary" id="finishButton" style="display: none;">Termina Quiz</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results View -->
        <div id="resultsView" class="view">
            <div class="results-container">
                <div class="results-icon">üéâ</div>
                <h2>Quiz Completato!</h2>
                <div class="results-score">
                    <div class="score-big" id="finalScore">0/0</div>
                    <div class="score-percentage" id="scorePercentage">0%</div>
                </div>
                <p class="results-message" id="resultsMessage"></p>
                <div class="results-actions">
                    <button class="btn btn-secondary" id="backToHome">üè† Home</button>
                    <button class="btn btn-primary" id="restartQuiz">üîÑ Rifai Quiz</button>
                    <button class="btn btn-secondary" id="backToDecksFromResults">üìö Altri Deck</button>
                </div>
            </div>

            <div class="review-section">
                <h3>üìù Riepilogo Risposte</h3>
                <div id="reviewContainer" class="review-container"></div>
            </div>
        </div>

        <!-- Import Modal -->
        <div id="importModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Importa Nuovo Quiz</h3>
                    <button class="modal-close" id="closeImportModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="importForm">
                        <div class="form-group">
                            <label for="courseSelect">Seleziona Corso</label>
                            <select id="courseSelect" required>
                                <option value="">-- Seleziona un corso esistente --</option>
                                <option value="__new__">+ Crea nuovo corso</option>
                            </select>
                        </div>
                        <div class="form-group" id="newCourseGroup" style="display: none;">
                            <label for="courseName">Nome Nuovo Corso</label>
                            <input type="text" id="courseName" placeholder="es. Sistemi Operativi">
                        </div>
                        <div class="form-group">
                            <label for="deckName">Nome Deck</label>
                            <input type="text" id="deckName" placeholder="es. Chapter 2" required>
                        </div>
                        <div class="form-group">
                            <label for="quizFile">File Quiz (.txt o .csv)</label>
                            <input type="file" id="quizFile" accept=".txt,.csv" required>
                            <small class="form-help">
                                Formato .txt: Domanda;Risposta1;Risposta2;Risposta3;Risposta4;;ID<br>
                                La prima risposta √® quella corretta.
                            </small>
                        </div>
                        <div class="modal-actions">
                            <button type="button" class="btn btn-secondary" id="cancelImport">Annulla</button>
                            <button type="submit" class="btn btn-primary">Importa</button>
                        </div>
                    </form>
                    <div id="importStatus" class="import-status" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- Add Questions Modal -->
        <div id="addQuestionsModal" class="modal">
            <div class="modal-content" style="max-width: 700px;">
                <div class="modal-header">
                    <h3>‚ûï Aggiungi Domande al Deck</h3>
                    <button class="modal-close" id="closeAddQuestionsModal">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- Deck Selection -->
                    <div class="form-group">
                        <label for="targetDeckSelect">Seleziona Deck di Destinazione</label>
                        <select id="targetDeckSelect" required>
                            <option value="">-- Seleziona un deck --</option>
                        </select>
                    </div>

                    <!-- Tab Navigation -->
                    <div class="tab-navigation">
                        <button class="tab-button active" data-tab="manual">‚úçÔ∏è Manuale</button>
                        <button class="tab-button" data-tab="import">üì• Importa File</button>
                    </div>

                    <!-- Manual Entry Tab -->
                    <div id="manualTab" class="tab-content active">
                        <form id="manualQuestionForm">
                            <div class="form-group">
                                <label for="questionText">Domanda *</label>
                                <textarea id="questionText" rows="3" placeholder="Inserisci la domanda..."
                                    required></textarea>
                                <small class="form-help">Puoi usare LaTeX: \( formula \) o \[ formula \]</small>
                            </div>

                            <div class="form-group">
                                <label>Risposte *</label>
                                <div class="answers-input">
                                    <div class="answer-item">
                                        <input type="text" id="answer0" placeholder="Risposta 1" required>
                                        <input type="radio" name="correctAnswer" value="0" checked>
                                        <label>Corretta</label>
                                    </div>
                                    <div class="answer-item">
                                        <input type="text" id="answer1" placeholder="Risposta 2" required>
                                        <input type="radio" name="correctAnswer" value="1">
                                        <label>Corretta</label>
                                    </div>
                                    <div class="answer-item">
                                        <input type="text" id="answer2" placeholder="Risposta 3" required>
                                        <input type="radio" name="correctAnswer" value="2">
                                        <label>Corretta</label>
                                    </div>
                                    <div class="answer-item">
                                        <input type="text" id="answer3" placeholder="Risposta 4" required>
                                        <input type="radio" name="correctAnswer" value="3">
                                        <label>Corretta</label>
                                    </div>
                                </div>
                            </div>

                            <div class="modal-actions">
                                <button type="button" class="btn btn-secondary" id="cancelManualAdd">Annulla</button>
                                <button type="submit" class="btn btn-primary">‚úÖ Aggiungi Domanda</button>
                            </div>
                        </form>

                        <div id="manualAddStatus" class="import-status" style="display: none; margin-top: 1rem;"></div>
                    </div>

                    <!-- Import Tab -->
                    <div id="importTab" class="tab-content">
                        <form id="importQuestionsForm">
                            <div class="form-group">
                                <label for="questionsFile">File Domande (.txt o .csv) *</label>
                                <input type="file" id="questionsFile" accept=".txt,.csv" required>
                                <small class="form-help">
                                    Formato .txt: Domanda;Risposta1;Risposta2;Risposta3;Risposta4;;ID<br>
                                    Formato .csv: domanda,risposta1,risposta2,risposta3,risposta4,correctIndex<br>
                                    La prima risposta √® quella corretta (o specifica correctIndex nel CSV).
                                </small>
                            </div>

                            <div class="modal-actions">
                                <button type="button" class="btn btn-secondary" id="cancelImportAdd">Annulla</button>
                                <button type="submit" class="btn btn-primary">üì• Importa Domande</button>
                            </div>
                        </form>

                        <div id="importAddStatus" class="import-status" style="display: none; margin-top: 1rem;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Code Generator Modal -->
        <div id="codeModal" class="modal">
            <div class="modal-content" style="max-width: 900px;">
                <div class="modal-header">
                    <h3>Codice data.js Generato</h3>
                    <button class="modal-close" id="closeCodeModal">&times;</button>
                </div>
                <div class="modal-body">
                    <p style="margin-bottom: 1rem; color: var(--text-secondary);">
                        üìã <strong>Istruzioni:</strong>
                    </p>
                    <ol style="margin-bottom: 1.5rem; color: var(--text-secondary); line-height: 1.8;">
                        <li>Copia tutto il codice qui sotto</li>
                        <li>Apri il file <code>data.js</code> del tuo progetto</li>
                        <li>Sostituisci TUTTO il contenuto con questo codice</li>
                        <li>Salva il file</li>
                        <li>Fai commit e push su GitHub:
                            <pre
                                style="background: var(--bg-secondary); padding: 0.5rem; border-radius: 4px; margin-top: 0.5rem;">git add data.js
git commit -m "Update quiz data"
git push</pre>
                        </li>
                        <li>Aspetta 1-2 minuti che GitHub Pages si aggiorni</li>
                        <li>‚úÖ Tutti vedranno i quiz su tutti i dispositivi!</li>
                    </ol>
                    <div style="position: relative;">
                        <button class="btn btn-primary" id="copyCodeButton"
                            style="position: absolute; top: 0.5rem; right: 0.5rem; z-index: 10;">
                            üìã Copia Codice
                        </button>
                        <textarea id="generatedCode" readonly style="
                            width: 100%;
                            height: 400px;
                            background: var(--bg-secondary);
                            color: var(--text-primary);
                            border: 2px solid var(--bg-hover);
                            border-radius: var(--border-radius-sm);
                            padding: 1rem;
                            font-family: 'Courier New', monospace;
                            font-size: 0.875rem;
                            resize: vertical;
                        "></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Include MathJax for LaTeX rendering -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

    <!-- Application Scripts -->
    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Application Scripts -->
    <!-- <script src="data.js"></script> -->
    <script src="supabase-client.js"></script>
    <script src="parser.js"></script>
    <script src="storage.js"></script>
    <script src="app.js"></script>
</body>

</html>